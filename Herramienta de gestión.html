<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesti√≥n de Productos Saludables - MIK√ö</title>

<!-- Librer√≠as -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<!-- Fuente Amatic Pro -->
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Amatic SC', cursive;
  margin: 0;
  padding: 20px;
  background: #f6f3fa;
  color: #333;
}

header {
  display: flex;
  align-items: center;
  background: #ffffff;
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
header img {
  height: 80px;
  margin-right: 20px;
  border-radius: 50%;
  border: 3px solid #7b1fa2;
}
header h1 {
  font-size: 2.5em;
  color: #4caf50;
  margin: 0;
}

section {
  background: #ffffff;
  margin-bottom: 20px;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
h3 {
  background: linear-gradient(90deg, #7b1fa2, #4caf50);
  color: white;
  padding: 10px;
  border-radius: 8px;
  font-size: 1.8em;
}
label {
  display: block;
  margin-top: 8px;
  font-weight: bold;
}
input, select, textarea {
  padding: 8px;
  margin-top: 4px;
  width: 100%;
  max-width: 400px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-family: 'Segoe UI', sans-serif;
}
button {
  background-color: #7b1fa2;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  margin-top: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
button:hover { background-color: #4caf50; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-family: 'Segoe UI', sans-serif;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th {
  background-color: #d1c4e9;
  color: #4a148c;
}

.botones {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
}
button.exportar {
  background-color: #4caf50;
  font-size: 1.2em;
  padding: 12px 24px;
}
button.exportar:hover { background-color: #2e7d32; }
button.reiniciar {
  background-color: #9c27b0;
  font-size: 1.2em;
  padding: 12px 24px;
}
button.reiniciar:hover { background-color: #6a0080; }

.graficos-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  align-items: flex-start;
  gap: 20px;
}
.graficos-container canvas {
  flex: 1 1 45%;
  max-width: 400px;
  max-height: 250px;
}
</style>
</head>
<body>

<header>
  <img src="https://i.postimg.cc/L8bKkfcp/Whats-App-Image-2025-11-08-at-2-26-25-PM.jpg" alt="Logo MIK√ö Saludable">
  <h1>Gesti√≥n de Productos Saludables</h1>
</header>

<section>
  <h3>Registrar Cliente</h3>
  <label>Nombre:</label><input id="clienteNombre">
  <label>Correo:</label><input id="clienteCorreo">
  <label>Tel√©fono:</label><input id="clienteTelefono">
  <button onclick="agregarCliente()">Guardar Cliente</button>
  <table id="tablaClientes"><thead><tr><th>Nombre</th><th>Correo</th><th>Tel√©fono</th></tr></thead><tbody></tbody></table>
</section>

<section>
  <h3>Registrar Producto</h3>
  <label>Nombre:</label><input id="nombreProducto">
  <label>SKU:</label><input id="skuProducto">
  <label>Precio:</label><input id="precioProducto" type="number">
  <label>Stock:</label><input id="stockProducto" type="number">
  <button onclick="agregarProducto()">Guardar Producto</button>
  <table id="tablaProductos"><thead><tr><th>Nombre</th><th>SKU</th><th>Precio</th><th>Stock</th></tr></thead><tbody></tbody></table>
</section>

<section>
  <h3>Registrar Venta</h3>
  <label>Producto:</label><select id="ventaProducto"></select>
  <label>Cliente:</label><select id="ventaCliente"></select>
  <label>Cantidad:</label><input id="ventaCantidad" type="number">
  <button onclick="registrarVenta()">Registrar Venta</button>
  <table id="tablaVentas"><thead><tr><th>Producto</th><th>Cliente</th><th>Cantidad</th><th>Total</th></tr></thead><tbody></tbody></table>
</section>

<section>
  <h3>üì¶ Registro de Devoluciones</h3>
  <label>Tipo de Devoluci√≥n:</label>
  <select id="tipoDevolucion">
    <option value="">Seleccione...</option>
    <option value="Cliente">De Cliente</option>
    <option value="Proveedor">A Proveedor</option>
  </select>
  <label>Producto:</label><select id="productoDevolucion"></select>
  <label>Cantidad:</label><input id="cantidadDevolucion" type="number" min="1">
  <label>Motivo:</label><textarea id="motivoDevolucion" rows="3"></textarea>
  <label>Fecha:</label><input id="fechaDevolucion" type="date">
  <button onclick="registrarDevolucion()">Registrar Devoluci√≥n</button>
  <table id="tablaDevoluciones"><thead><tr><th>Tipo</th><th>Producto</th><th>Cantidad</th><th>Motivo</th><th>Fecha</th></tr></thead><tbody></tbody></table>
</section>

<div class="botones">
  <button class="exportar" onclick="exportarExcel()">üìÅ Exportar a Excel</button>
  <button class="reiniciar" onclick="reiniciarDatos()">‚ôªÔ∏è Reiniciar Datos</button>
</div>

<section>
  <h3>Gr√°ficos</h3>
  <div class="graficos-container">
    <canvas id="graficoBarras"></canvas>
    <canvas id="graficoPastel"></canvas>
  </div>
</section>

<script>
let productos = JSON.parse(localStorage.getItem('productos') || '[]');
let ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
let devoluciones = JSON.parse(localStorage.getItem('devoluciones') || '[]');

function guardarDatos(){
  localStorage.setItem('productos', JSON.stringify(productos));
  localStorage.setItem('ventas', JSON.stringify(ventas));
  localStorage.setItem('clientes', JSON.stringify(clientes));
  localStorage.setItem('devoluciones', JSON.stringify(devoluciones));
  mostrarTablas(); actualizarSelects(); dibujarGraficos();
}

function agregarCliente(){
  const nombre = clienteNombre.value, correo = clienteCorreo.value, tel = clienteTelefono.value;
  if(!nombre) return alert('Ingrese un nombre');
  clientes.push({nombre, correo, tel});
  clienteNombre.value = clienteCorreo.value = clienteTelefono.value = '';
  guardarDatos();
}

function agregarProducto(){
  const nombre = nombreProducto.value.trim();
  const sku = skuProducto.value.trim();
  const precio = +precioProducto.value;
  const stock = +stockProducto.value;
  if(!nombre || !precio || !stock) return alert('Complete todos los campos');

  const existente = productos.find(p => p.nombre.toLowerCase() === nombre.toLowerCase());
  if(existente){
    existente.stock += stock;
    existente.precio = precio;
  } else {
    productos.push({nombre, sku, precio, stock});
  }
  nombreProducto.value = skuProducto.value = precioProducto.value = stockProducto.value = '';
  guardarDatos();
}

function registrarVenta(){
  const prodIndex = ventaProducto.value, cliIndex = ventaCliente.value, cantidad = +ventaCantidad.value;
  if(prodIndex==='' || cliIndex==='' || !cantidad) return alert('Complete todos los campos');
  const producto = productos[prodIndex];
  if(cantidad > producto.stock) return alert('Stock insuficiente');
  producto.stock -= cantidad;
  const cliente = clientes[cliIndex];
  const total = cantidad * producto.precio;
  ventas.push({producto: producto.nombre, cliente: cliente.nombre, cantidad, total});
  ventaCantidad.value = '';
  guardarDatos();
}

function registrarDevolucion(){
  const tipo = tipoDevolucion.value;
  const prodIndex = productoDevolucion.value;
  const cantidad = +cantidadDevolucion.value;
  const motivo = motivoDevolucion.value;
  const fecha = fechaDevolucion.value;
  if(!tipo || prodIndex==='' || !cantidad || !fecha) return alert('Complete todos los campos');
  const producto = productos[prodIndex];
  devoluciones.push({tipo, producto: producto.nombre, cantidad, motivo, fecha});
  if(tipo === "Cliente") producto.stock += cantidad;
  tipoDevolucion.value = productoDevolucion.value = cantidadDevolucion.value = motivoDevolucion.value = fechaDevolucion.value = '';
  guardarDatos();
}

function mostrarTablas(){
  tablaProductos.querySelector('tbody').innerHTML = productos.map(p=>`<tr><td>${p.nombre}</td><td>${p.sku}</td><td>${p.precio}</td><td>${p.stock}</td></tr>`).join('');
  tablaVentas.querySelector('tbody').innerHTML = ventas.map(v=>`<tr><td>${v.producto}</td><td>${v.cliente}</td><td>${v.cantidad}</td><td>${v.total}</td></tr>`).join('');
  tablaClientes.querySelector('tbody').innerHTML = clientes.map(c=>`<tr><td>${c.nombre}</td><td>${c.correo}</td><td>${c.tel}</td></tr>`).join('');
  tablaDevoluciones.querySelector('tbody').innerHTML = devoluciones.map(d=>`<tr><td>${d.tipo}</td><td>${d.producto}</td><td>${d.cantidad}</td><td>${d.motivo}</td><td>${d.fecha}</td></tr>`).join('');
}

function actualizarSelects(){
  ventaProducto.innerHTML = productos.map((p,i)=>`<option value="${i}">${p.nombre}</option>`).join('');
  ventaCliente.innerHTML = clientes.map((c,i)=>`<option value="${i}">${c.nombre}</option>`).join('');
  productoDevolucion.innerHTML = productos.map((p,i)=>`<option value="${i}">${p.nombre}</option>`).join('');
}

async function exportarExcel(){
  const wb = new ExcelJS.Workbook();
  const hojas = [
    {nombre: 'Productos', datos: productos, columnas: [
      {header:'Nombre', key:'nombre', width:25}, {header:'SKU', key:'sku', width:15},
      {header:'Precio', key:'precio', width:15}, {header:'Stock', key:'stock', width:15}
    ]},
    {nombre:'Clientes', datos:clientes, columnas:[
      {header:'Nombre', key:'nombre', width:25}, {header:'Correo', key:'correo', width:30}, {header:'Tel√©fono', key:'tel', width:20}
    ]},
    {nombre:'Ventas', datos:ventas, columnas:[
      {header:'Producto', key:'producto', width:25}, {header:'Cliente', key:'cliente', width:25}, {header:'Cantidad', key:'cantidad', width:15}, {header:'Total', key:'total', width:15}
    ]},
    {nombre:'Devoluciones', datos:devoluciones, columnas:[
      {header:'Tipo', key:'tipo', width:20}, {header:'Producto', key:'producto', width:25}, {header:'Cantidad', key:'cantidad', width:15}, {header:'Motivo', key:'motivo', width:35}, {header:'Fecha', key:'fecha', width:20}
    ]}
  ];
  const estiloEncabezado = {
    font: {bold:true,color:{argb:'FFFFFFFF'}},
    fill:{type:'pattern',pattern:'solid',fgColor:{argb:'FF4CAF50'}},
    alignment:{horizontal:'center'}
  };
  hojas.forEach(h=>{
    const hoja = wb.addWorksheet(h.nombre);
    hoja.columns = h.columnas;
    hoja.addRows(h.datos);
    hoja.getRow(1).eachCell(c=>c.style=estiloEncabezado);
  });
  const buffer = await wb.xlsx.writeBuffer();
  saveAs(new Blob([buffer],{type:"application/octet-stream"}),"MIKU_Gestion.xlsx");
}

function dibujarGraficos(){
  if(window.barChart) window.barChart.destroy();
  if(window.pieChart) window.pieChart.destroy();
  const ctx1 = document.getElementById('graficoBarras');
  const ctx2 = document.getElementById('graficoPastel');
  const ventasPorProducto = {};
  const ventasPorCliente = {};
  ventas.forEach(v=>{
    ventasPorProducto[v.producto]=(ventasPorProducto[v.producto]||0)+v.total;
    ventasPorCliente[v.cliente]=(ventasPorCliente[v.cliente]||0)+v.total;
  });
  window.barChart=new Chart(ctx1,{
    type:'bar',
    data:{labels:Object.keys(ventasPorProducto),
    datasets:[{label:'Ventas por producto',data:Object.values(ventasPorProducto),backgroundColor:'#7b1fa2'}]},
    options:{responsive:true,plugins:{legend:{display:false},datalabels:{color:'#fff',anchor:'end',align:'top'}},scales:{y:{beginAtZero:true}}},
    plugins:[ChartDataLabels]
  });
  window.pieChart=new Chart(ctx2,{
    type:'pie',
    data:{labels:Object.keys(ventasPorCliente),
    datasets:[{data:Object.values(ventasPorCliente),backgroundColor:['#4caf50','#81c784','#a5d6a7','#c8e6c9','#e8f5e9','#7b1fa2','#9c27b0','#ce93d8']}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'},datalabels:{color:'#000',formatter:(value,ctx)=>{let sum=ctx.chart.data.datasets[0].data.reduce((a,b)=>a+b,0);return((value/sum*100).toFixed(1)+'%');}}}},
    plugins:[ChartDataLabels]
  });
}

function reiniciarDatos(){
  if(!confirm("‚ö†Ô∏è ¬øSeguro que deseas reiniciar todos los registros?"))return;
  localStorage.clear();
  productos=[];ventas=[];clientes=[];devoluciones=[];
  mostrarTablas();actualizarSelects();dibujarGraficos();
  alert("‚úÖ Todos los datos fueron reiniciados correctamente.");
}

mostrarTablas();actualizarSelects();dibujarGraficos();
</script>
</body>
</html>
    
  </body>
  
</html>
